import type { FormSchemaGetter } from '#/adapter/form';
import type { VxeGridProps } from '#/adapter/vxe-table';

import { DictEnum } from '@vben/constants';

import { getDictOptions } from '#/utils/dict';
import { renderDictTag } from '#/utils/render';

export const querySchema: FormSchemaGetter = () => [
#foreach($column in $columns)
    #if ($column.query)
    #set ($dictType=$column.dictType)
    #set ($javaField = $column.javaField)
    #set ($AttrName=$column.javaField.substring(0,1).toUpperCase() + ${column.javaField.substring(1)})
    #set($parentheseIndex=$column.columnComment.indexOf("（"))
    #if($parentheseIndex != -1)
        #set($comment=$column.columnComment.substring(0, $parentheseIndex))
    #else
        #set($comment=$column.columnComment)
    #end
    {
        label: '${comment}',
        fieldName: '${javaField}',
    #if ($column.htmlType == "input")
        component: 'Input',
        componentProps: {
            placeholder: '请输入${comment}',
        },
    #elseif ($column.htmlType == "select" || $column.htmlType == "radio")
        component: 'Select',
        componentProps: {
            placeholder: '请选择${comment}',
        #if ("" != $dictType)## 设置了 dictType 数据字典的情况
            options: getDictOptions(DictEnum.$dictType.toUpperCase()),
        #else## 未设置 dictType 数据字典的情况
            options: [],
        #end
        },
    #elseif($column.htmlType == "datetime")
        component: 'RangePicker',
        componentProps: {
            placeholder: '请选择$comment',
        },
    #end
        colProps: { span: 8 },
    },
#end
#end
]

export const columns: VxeGridProps['columns'] = [
    { type: 'checkbox', width: 60 },
#foreach($column in $columns)
#if ($column.list)
#set ($dictType=$column.dictType)
#set ($javaField = $column.javaField)
#set ($AttrName=$column.javaField.substring(0,1).toUpperCase() + ${column.javaField.substring(1)})
#set ($comment=$column.columnComment)
#if("" != $column.dictType)## 数据字典
    {
        title: '${comment}',
        field: '${javaField}',
        slots: {
            default: ({ row }) => {
                const { $javaField } = row;
                return renderDictTag(
                    $javaField as string,
                    getDictOptions(DictEnum.$dictType.toUpperCase()),
                );
            },
        },
    },
#elseif(!$column.pk)
    {
        title: '${comment}',
        field: '${javaField}',
    },
#end
#end
#end
    {
        field: 'action',
        fixed: 'right',
        slots: { default: 'action' },
        title: '操作',
        width: 180,
    },
]

export const ModalSchema: FormSchemaGetter = () => [
#foreach($column in $columns)
#if ($column.edit || $column.insert)
#set ($dictType = $column.dictType)
#set ($javaField = $column.javaField)
#set ($AttrName = $column.javaField.substring(0,1).toUpperCase() + ${column.javaField.substring(1)})
#set ($comment = $column.columnComment)
#if($column.isPk==1)
    {
        label: '${comment}',
        fieldName: '${javaField}',
        component: 'Input',
        dependencies: {
            show: () => false,
            triggerFields: [''],
        },
    },
#else
    {
        label: '${comment}',
        fieldName: '${javaField}',
    #if ($column.required)
        rules: 'required',
    #end
    #if ($column.htmlType == "input")
        component: 'Input',
        componentProps: {
            placeholder: '请输入${comment}',
        },
    #elseif($column.htmlType == "imageUpload")## 图片上传
        component: 'FileUpload',
        componentProps: {
            fileType: 'image',
            maxCount: 1,
        },
    #elseif($column.htmlType == "fileUpload")## 文件上传
        component: 'FileUpload',
        componentProps: {
            fileType: 'file',
            maxCount: 1,
        },
    #elseif($column.htmlType == "editor")## 文本编辑器
        component: 'Editor',
        componentProps: {
            placeholder: '请输入${comment}',
        },
    #elseif($column.htmlType == "select")## 下拉框
        component: 'Select',
        componentProps: {
            class: 'w-[180px]',
            placeholder: '请选择${comment}',
        #if ("" != $dictType)## 有数据字典
            options: getDictOptions(DictEnum.$dictType.toUpperCase()),
        #else##没数据字典
            options:[],
        #end
        },
    #elseif($column.htmlType == "checkbox")## 多选框
        component: 'CheckboxGroup',
        componentProps: {
        #if ("" != $dictType)## 有数据字典
            options: getDictOptions(DictEnum.$dictType.toUpperCase()),
        #else ##没数据字典
            options:[],
        #end
        },
    #elseif($column.htmlType == "radio")## 单选框
        component: 'RadioGroup',
        componentProps: {
        #if ("" != $dictType)## 有数据字典
            options: getDictOptions(DictEnum.$dictType.toUpperCase()),
        #else##没数据字典
            options:[],
        #end
        },
    #elseif($column.htmlType == "datetime")## 时间框
        component: 'DatePicker',
        componentProps: {
            showTime: true,
            format: 'YYYY-MM-DD HH:mm:ss',
            valueFormat: 'x',
        },
    #elseif($column.htmlType == "textarea")## 文本域
        component: 'Textarea',
        componentProps: {
            placeholder: '请输入${comment}',
        },
    #end
    },
#end
#end
#end
]
